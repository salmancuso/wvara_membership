{% extends "base.html" %}

{% block title %}Admin Dashboard - WVARA Membership{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-12">
        <h2 class="mb-4">
            <i class="bi bi-gear-fill"></i> Admin Dashboard
        </h2>
    </div>
</div>

<!-- Statistics Cards -->
<div class="row mb-4">
    <div class="col-md-3">
        <div class="card text-white bg-primary">
            <div class="card-body">
                <h3 class="card-title">{{ total_members }}</h3>
                <p class="card-text">
                    <i class="bi bi-people-fill"></i> Total Members
                </p>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="card text-white bg-success">
            <div class="card-body">
                <h3 class="card-title">{{ truly_active_members }}</h3>
                <p class="card-text">
                    <i class="bi bi-check-circle-fill"></i> Active Members
                </p>
                <small class="text-white">Dues paid + activity in last 6 months</small>
                <hr style="border-color: rgba(255,255,255,0.3); margin: 0.5rem 0;">
                <small class="text-white">{{ members_with_paid_dues }} with current dues</small>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="card text-white bg-danger">
            <div class="card-body">
                <h3 class="card-title">{{ expired_dues|length }}</h3>
                <p class="card-text">
                    <i class="bi bi-exclamation-triangle-fill"></i> Expired Dues
                </p>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="card text-white bg-warning">
            <div class="card-body">
                <h3 class="card-title">{{ expiring_soon|length }}</h3>
                <p class="card-text">
                    <i class="bi bi-calendar-x"></i> Expiring Soon
                </p>
            </div>
        </div>
    </div>
</div>

<!-- Alerts for Expired/Expiring Dues -->
{% if expired_dues %}
<div class="row">
    <div class="col-md-12">
        <div class="card border-danger">
            <div class="card-header bg-danger text-white">
                <i class="bi bi-exclamation-triangle-fill"></i> Members with Expired Dues
            </div>
            <div class="card-body">
                <p class="text-muted">
                    The following members have not paid their dues for the current year. 
                    They are currently in the grace period (through February). 
                    After the grace period, they should be marked as inactive.
                </p>
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Call Sign</th>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Last Contact</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for member in expired_dues %}
                                <tr>
                                    <td><strong>{{ member.call_sign }}</strong></td>
                                    <td>{{ member.get_full_name() }}</td>
                                    <td>{{ member.email }}</td>
                                    <td>{{ member.last_contact.strftime('%Y-%m-%d') if member.last_contact else 'Unknown' }}</td>
                                    <td>
                                        <a href="{{ url_for('admin_member_detail', member_id=member.id) }}" 
                                           class="btn btn-sm btn-primary">
                                            <i class="bi bi-eye"></i> View
                                        </a>
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
{% endif %}

<div class="row mt-4">
    <!-- Recent Dues Payments -->
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <i class="bi bi-credit-card"></i> Recent Dues Payments
            </div>
            <div class="card-body">
                {% if recent_payments %}
                    <div class="table-responsive">
                        <table class="table table-sm">
                            <thead>
                                <tr>
                                    <th>Call Sign</th>
                                    <th>Year</th>
                                    <th>Amount</th>
                                    <th>Date</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for payment in recent_payments %}
                                    <tr>
                                        <td><strong>{{ payment.member.call_sign }}</strong></td>
                                        <td>{{ payment.year }}</td>
                                        <td>${{ "%.2f"|format(payment.amount) }}</td>
                                        <td>{{ payment.payment_date.strftime('%Y-%m-%d') }}</td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <p class="text-muted">No recent payments.</p>
                {% endif %}
                
                <div class="text-end mt-2">
                    <a href="{{ url_for('admin_dues') }}" class="btn btn-sm btn-primary">
                        <i class="bi bi-plus-circle"></i> Record Payment
                    </a>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Recent Meeting Attendance -->
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <i class="bi bi-calendar-check"></i> Recent Meeting Attendance
            </div>
            <div class="card-body">
                {% if recent_attendance %}
                    <div class="table-responsive">
                        <table class="table table-sm">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Call Sign</th>
                                    <th>Name</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for attendance in recent_attendance %}
                                    <tr>
                                        <td>{{ attendance.meeting_date.strftime('%Y-%m-%d') }}</td>
                                        <td><strong>{{ attendance.member.call_sign }}</strong></td>
                                        <td>{{ attendance.member.get_full_name() }}</td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <p class="text-muted">No recent attendance records.</p>
                {% endif %}
                
                <div class="text-end mt-2">
                    <a href="{{ url_for('admin_attendance') }}" class="btn btn-sm btn-primary">
                        <i class="bi bi-plus-circle"></i> Record Attendance
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Quick Actions -->
<div class="row mt-4">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header">
                <i class="bi bi-lightning-fill"></i> Quick Actions
            </div>
            <div class="card-body">
                <div class="row text-center">
                    <div class="col-md-3 mb-3">
                        <a href="{{ url_for('admin_members') }}" class="btn btn-outline-primary btn-lg w-100">
                            <i class="bi bi-people"></i><br>
                            Manage Members
                        </a>
                    </div>
                    <div class="col-md-3 mb-3">
                        <a href="{{ url_for('admin_dues') }}" class="btn btn-outline-success btn-lg w-100">
                            <i class="bi bi-credit-card"></i><br>
                            Record Dues
                        </a>
                    </div>
                    <div class="col-md-3 mb-3">
                        <a href="{{ url_for('admin_attendance') }}" class="btn btn-outline-info btn-lg w-100">
                            <i class="bi bi-calendar-check"></i><br>
                            Take Attendance
                        </a>
                    </div>
                    <div class="col-md-3 mb-3">
                        <a href="{{ url_for('admin_reports') }}" class="btn btn-outline-secondary btn-lg w-100">
                            <i class="bi bi-file-earmark-text"></i><br>
                            Generate Reports
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
